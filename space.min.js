function Space(a){this._properties=[];this._values=[];this._propertyCounts={};this._cache={};this._load(a);return this}Space.version="0.11.1";Space.removeItems=function(a,b){var c=[];"number"===typeof b&&(b=[b]);for(var d=b.length-1;0<=d;d--)c.push(a.splice(b[d],1));return c};Space.isXPath=function(a){return a.match(/ /)};
Space.fromHeredoc=function(a,b,c){a=a.replace(/\n\r/g,"\n");a=a.split("\n");var d=null,e=[],f=RegExp("^"+b+"(?: |$)"),g=a.length;b=b.length;c=RegExp("^"+c);for(var h=0;h<g;h++)null===d?a[h].match(f)&&(d=h,a[h].length===b&&(a[h]+=" ")):a[h].match(c)?(d=null,e.push(h)):a[h]=" "+a[h];Space.removeItems(a,e);return new Space(a.join("\n"))};
Space.fromFile=function(a,b,c){if("undefined"===typeof require)throw Error("fromFile only works with node.js");"undefined"===typeof fs&&(fs=require("fs"));"function"===typeof b&&(c=b,b=null);b||(b="utf8");return!c?new Space(fs.readFileSync(a,b)):fs.readFile(a,b,function(a,b){return a?c(a):c(a,new Space(b))})};Space.fromCsv=function(a,b){return Space.fromDelimiter(a,",",b)};
Space.fromDelimiter=function(a,b,c){var d=a.length,e="",f=0,g=!1,h=[[]],j=new Space,l=0;for(c=!1!==c;f<d;){var m=a[f];g?'"'!==m?e+=m:'"'!==a[f+1]?g=!1:(e+='"',f++):m===b?(h[l].push(e),e="",'"'===a[f+1]&&(g=!0,f++)):"\n"===m?(h[l].push(e),e="",l++,a[f+1]&&(h[l]=[]),'"'===a[f+1]&&(g=!0,f++)):f===d-1?h[l].push(e+m):e+=m;f++}var n=h[0];a=n.length;if(c)for(b=0;b<a;b++)n[b]=n[b].replace(/ /g,"");else{n=[];for(b=0;b<a;b++)n.push(b)}h.forEach(function(a,b){if(0===b&&c)return!0;var d=new Space;n.forEach(function(b,
c){var e=a[c];if(""===e)return!0;d.append(b,e)});j.append(c?b-1:b,d)});return j};Space.fromSsv=function(a,b){return Space.fromDelimiter(a," ",b)};Space.fromTsv=function(a,b){return Space.fromDelimiter(a,"\t",b)};Space._parseXml2=function(a){var b=document.createElement("div");b.innerHTML=a;return b};
Space._initializeXmlParser=function(){if(!Space._parseXml)if("undefined"!==typeof window.DOMParser)Space._parseXml=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")};else if("undefined"!==typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM"))Space._parseXml=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b};else throw Error("No XML parser found");};
Space.fromXml=function(a){Space._initializeXmlParser();var b=Space._parseXml(a);try{return Space._fromXml(b).get("children")}catch(c){return Space._fromXml(Space._parseXml2(a)).get("children")}};
Space._fromXml=function(a){var b=new Space,c=new Space;if(a.attributes)for(var d=0;d<a.attributes.length;d++)b.set(a.attributes[d].name,a.attributes[d].value);a.data&&c.push(a.data);if(a.childNodes&&0<a.childNodes.length)for(d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if(e.tagName&&e.tagName.match(/parsererror/i))throw Error("Parse Error");0<e.childNodes.length&&e.tagName?c.append(e.tagName,Space._fromXml(e)):e.tagName?c.append(e.tagName,new Space):e.data&&(e=e.data.trim())&&c.push(e)}0<
c.length&&b.set("children",c);return b};Space.toFile=function(a,b,c,d,e){if("undefined"===typeof require)throw Error("toFile only works with node.js");"undefined"===typeof fs&&(fs=require("fs"));"function"===typeof c&&(d=c,c=null);return!e&&!d?fs.writeFileSync(a,b.toString(),c):fs.writeFile(a,b.toString(),c,d)};
Space._ajaxRequest=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&200==d.status?b(new Space(d.responseText)):4==d.readyState&&b(null,"Error Code: "+d.status+". "+d.statusText)};d.open(c?"POST":"GET",a,!0);c&&d.setRequestHeader("Content-type","text/plain");d.send(c?c.toString():null)};
Space._nodeRequest=function(a,b,c){"undefined"===typeof request&&(request=require("request"));return c?request.post({url:a,formData:c.toString()},b):request.get(a,function(a,c,f){if(a)return b(null,a);b(new Space(f))})};Space._isNode=function(){return"undefined"!==typeof require};Space.fromUrl=function(a,b){Space._isNode()?Space._nodeRequest(a,b):Space._ajaxRequest(a,b)};Space.toUrl=function(a,b,c){Space._isNode()?Space._nodeRequest(a,c,b):Space._ajaxRequest(a,c,b)};
Space.pathBranch=function(a){a=a.split(/ /g);if(2>a.length)return"";a.pop();return a.join(" ")};Space.pathLeaf=function(a){var b=a.split(/ /g);return 2>b.length?a:b[b.length-1]};Space.strRepeat=function(a,b){for(var c="",d=0;d<b;d++)c+=a;return c};Space.union=function(){for(var a=Space.unionSingle(arguments[0],arguments[1]),b=arguments.length,c=0;c<b&&!(1!==c&&(a=Space.unionSingle(a,arguments[c]),!a.length));c++);return a};
Space.unionSingle=function(a,b){var c=new Space;if(!(b instanceof Space))return c;a.each(function(a,e){e instanceof Space&&(b._getValueByProperty(a)&&b._getValueByProperty(a)instanceof Space)&&c._setPair(a,Space.unionSingle(e,b._getValueByProperty(a)));e===b._getValueByProperty(a)&&c._setPair(a,e)});return c};Space.prototype.append=function(a,b){this._setPair(a,b);return this.trigger("append",a,b).trigger("change")};
Space.prototype._clear=function(){this._properties=[];this._values=[];this._propertyCounts={};this._cache={};return this};Space.prototype.clear=function(a){if(this.isEmpty())return this;this._clear();this.trigger("clear");a&&this._load(a);this.trigger("change");return this};Space.prototype.clearListeners=function(a){if(!this._events)return this;if(a)delete this._events[a];else for(a in this._events)this._events.hasOwnProperty(a)&&delete this._events[a];return this};Space.prototype.clone=function(){return new Space(this.toString())};
Space.prototype.concat=function(a){"string"===typeof a&&(a=new Space(a));var b=this;a.each(function(a,d){b.append(a,d)});return this};Space.prototype.create=function(a,b){this._setPair(a,b);return this.trigger("create",a,b).trigger("change")};Space.prototype._delete=function(a){return"number"===typeof a?this._deleteByIndex(a):a.toString().match(/ /)?this._deleteByXPath(a):this._deleteByProperty(a)};
Space.prototype._deleteByIndex=function(a){if(void 0===this._properties[a])return 0;var b=this._properties.splice(a,1),c=this._values.splice(a,1);this._propertyCounts[b]--;if(this._propertyCounts[b]){if(c===this._cache[b])for(;0<a;a--)if(this._properties[a]===b){this._cache[b]=this._values[a];break}}else delete this._cache[b],delete this._propertyCounts[b];return 1};Space.prototype._deleteByProperty=function(a){a=this.indexOf(a);return-1===a?0:this._deleteByIndex(a)};
Space.prototype._deleteByXPath=function(a){var b=a.split(/ /);a=b.pop();b=this.get(b.join(" "));return b instanceof Space?b._delete(a):0};Space.prototype["delete"]=function(a){this._delete(a)&&this.trigger("delete",a);return this.trigger("change")};
Space.prototype.diff=function(a){var b=new Space;a instanceof Space||(a=new Space(a));this.each(function(d){var c=a._getValueByProperty(d);if(void 0===c)return b._setPair(d,""),!0;if(typeof this._getValueByProperty(d)!==typeof c)return"object"===typeof c?b._setPair(d,new Space(c)):this._getValueByProperty(d)!=c&&b._setPair(d,c),!0;if("object"!==typeof this._getValueByProperty(d))return this._getValueByProperty(d)!=c&&b._setPair(d,c),!0;c=this._getValueByProperty(d).diff(c);c.length&&b._setPair(d,
c)});var c=this;a.each(function(d,e){if(c.has(d))return!0;if("object"!==typeof e)return b._setPair(d,e),!0;e instanceof Space?b._setPair(d,new Space(e)):b._setPair(d,new Space(a))});return b};
Space.prototype.diffOrder=function(a){a instanceof Space||(a=new Space(a));var b=new Space,c=this;a.each(function(a,e){if(!(e instanceof Space)||!(c._getValueByProperty(a)instanceof Space))return!0;var f=c._getValueByProperty(a).diffOrder(e);if(f.isEmpty())return!0;b._setPair(a,f)});if(a.tableOfContents()===this.tableOfContents())return b;a.each(function(a){b.has(a)||b._setPair(a,new Space)});return b};
Space.prototype.each=function(a,b){for(var c=this._properties.length,d=0;d<c&&!(b&&this._values[d]instanceof Space&&this._values[d].each(a,b),!1===a.call(this,this._properties[d],this._values[d],d));d++);return this};Object.defineProperty(Space.prototype,"events",{get:function(){return this._events||{}}});Space.prototype.every=function(a){this.each(function(b,c,d){a.call(this,b,c,d);c instanceof Space&&c.every(a)});return this};
Space.prototype.filter=function(a){for(var b=new Space,c=this._properties.length,d=0;d<c;d++)!0===a.call(this,this._properties[d],this._values[d],d)&&b.append(this._properties[d],this._values[d]);return b};Space.prototype.find=function(a,b){var c=new Space;this.get(a)===b&&c.push(this);this.each(function(d,e){if(!(e instanceof Space))return!0;e.find(a,b).each(function(a,b){c.push(b)})});return c};Space.prototype.first=function(){return!this.length?new Space:(new Space).set(this._properties[0],this._values[0])};
Space.prototype.firstProperty=function(){return this.length?this._properties[0]:null};Space.prototype.firstValue=function(){return this.length?this._values[0]:null};Space.prototype.get=function(a){return void 0===a||null===a?void 0:this._getValueByString(a.toString())};Space.prototype.getAll=function(a){var b=new Space;this.each(function(c,d){if(c!==a)return!0;b.append(c,d)});return b};Space.prototype.getArray=function(a){var b=[];this.each(function(c,d){if(c!==a)return!0;b.push(d)});return b};
Space.prototype.getByIndex=function(a){return this._getValueByIndex(a)};Space.prototype.getByIndexPath=function(a){a=a.split(/ /g);var b=parseFloat(a.shift());return 0===a.length?this._getValueByIndex(b):this._getValueByIndex(b).getByIndexPath(a.join(" "))};Space.prototype.getBySpace=function(a){return this._getValueBySpace(a)};
Space.prototype.getCud=function(a){var b=new Space("created\nupdated\ndeleted\n"),c=this;a instanceof Space||(a=new Space(a));a.each(function(a,e){void 0===c.get(a)?b.set("created "+a,e):c.get(a).toString()!==e.toString()&&b.set("updated "+a,e)});this.each(function(c){void 0===a.get(c)&&b.set("deleted "+c,new Space)});return b};Space.prototype._getValueByIndex=function(a){0>a&&(a=this.length+a);return this._values[a]};Space.prototype._getValueByProperty=function(a){return this._cache[a]};
Space.prototype._getPropertyByIndex=function(a){var b=this.length;0>a&&(a=b+a);return a>=b?void 0:this._properties[a]};Space.prototype.getProperties=function(){return this._properties.slice(0)};Space.prototype._getValueByString=function(a){if(a){var b=this._getValueByProperty(a);if(b||""===b||0===b||!1===b)return b;if(a.match(/ /)&&(a=a.split(/ /g),b=a.shift(),this.has(b)&&this._getValueByProperty(b)instanceof Space))return this._getValueByProperty(b).get(a.join(" "))}};
Space.prototype._getValueBySpace=function(a){var b=new Space,c=this;a.each(function(d){var e=c._getValueByProperty(d);if("undefined"===typeof e)return!0;if(!(a._getValueByProperty(d)instanceof Space)||!a._getValueByProperty(d).length)return b._setPair(d,e),!0;if(!(e instanceof Space))return!0;b._setPair(d,e._getValueBySpace(a._getValueByProperty(d)))});return b};Space.prototype.getValues=function(){return this._values.slice(0)};Space.prototype.has=function(a){return!!this._getValueByProperty(a)};
Space.prototype.indexOf=function(a){if(!this._propertyCounts[a])return-1;for(var b=this.length,c=0;c<b;c++)if(this._properties[c]===a)return c;return-1};Space.prototype.insert=function(a,b,c){this._setPair(a,b,c);return this};Space.prototype.isEmpty=function(){return 0===this.length};Space.prototype.isFlat=function(){for(var a=this.length,b=0;b<a;b++)if(this._values[b]instanceof Space)return!1;return!0};
Space.prototype.isStringMap=function(a){for(var b=this.length,c={},d=0;d<b;d++){var e=this._properties[d];if(c[e])return!1;c[e]=!0;if(a&&(e=this._values[d],!(!e instanceof Space)&&!e.isStringMap()))return!1}return!0};Space.prototype.last=function(){if(!this.length)return new Space;var a=this.length-1;return(new Space).set(this._properties[a],this._values[a])};Space.prototype.lastProperty=function(){return!this.length?null:this._properties[this.length-1]};
Space.prototype.lastValue=function(){return!this.length?null:this._values[this.length-1]};Object.defineProperty(Space.prototype,"length",{get:function(){return this._properties.length}});Space._load2=!0;
Space.prototype._load=function(a){if("string"===typeof a){if(!a.length)return this;Space._load2?this._loadFromString2(a):this._loadFromString(a);return this}if(a instanceof Space){var b=this;a.each(function(a,d){d instanceof Space?b._setPair(a,d.clone()):b._setPair(a,d)});return this}a instanceof Array?this._loadFromArray(a):this._loadFromObject(a)};Space.prototype._loadFromArray=function(a){for(var b in a)this._loadPair(b.toString(),a[b])};
Space.prototype._loadPair=function(a,b){null===b?this._setPair(a,"null"):void 0===b?this._setPair(a,""):"object"!==typeof b?this._setPair(a,b.toString()):b instanceof Date?this._setPair(a,b.getTime().toString()):this._setPair(a,new Space(b))};Space.prototype._loadFromObject=function(a){for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&this._loadPair(b,a[b])};
Space.prototype._loadFromString2=function(a){for(var b="",c="",d="",e="",f=0,g=0,h={"0":this},j=0,l=0,m=!1,n=a.length,p=0;p<n;p++){var k=a[p];if("\r"!==k&&(m||!("\n"===k||" "===k)))if(m||(m=d=!0),d)" "===k?(d=!1,e=!0,j=f>=g?g:f):"\n"===k?(d=!1,f>=g&&(f=g),g=f+1,h[g]=new Space,h[f]._setPair(b,h[g]),f=0,b=""):b+=k;else if(e)if(l&&" "===k)f++,l--;else if(l)h[j]._setPair(b,c.substr(0,c.length-1)),c="",d=!0,e=!1,b=k,l=0;else if("\n"===k){l=j+1;for(f=0;"\n"===a[p+1];)p++;p!==a.length-1&&(c+=k)}else c+=
k;else"\n"!==k&&(" "===k?f++:(d=!0,b=k))}d&&h[f]._setPair(b,new Space);e&&h[j]._setPair(b,c);return this};Space.prototype._loadFromString=function(a){a=a.replace(/^\s*/,"");a=a.replace("\r","");a=a.replace(/\n\n+/,"\n");a=a.split(/\n(?! )/g);var b,c,d;for(d in a)c=a[d],(b=c.match(/^([^ ]+)(\n|$)/))?this._setPair(b[1],new Space(c.substr(b[1].length).replace(/\n /g,"\n"))):(b=c.match(/^([^ ]+) /))&&this._setPair(b[1],c.substr(b[1].length+1).replace(/\n /g,"\n"));return this};
Space.prototype.map=function(a,b,c,d){if(!d)return(new Space(this)).map(a,b,c);this._propertyCounts={};this._cache={};for(var e=this.length,f=0;f<e;f++){var g=this._properties[f];a&&(this._properties[f]=a(g));c&&this._values[f]instanceof Space?this._values[f].map(a,b,c,d):b&&(this._values[f]=b(this._values[f],this._properties[f],g));this._updateIndexAndCache(this._properties[f],this._values[f])}return this};Space.prototype.next=function(a){return this._getPropertyByIndex(this.indexOf(a)+1)};
Space.prototype.off=function(a,b){if(!this._events||!this._events[a])return this;for(var c in this._events[a])this._events[a][c]===b&&this._events[a].splice(c,1);return this};Space.prototype.on=function(a,b){this._events||(this._events={});this._events[a]||(this._events[a]=[]);this._events[a].push(b);return this};
Space.prototype._patch=function(a){a instanceof Space||(a=new Space(a));var b=this;a.each(function(a,d){if("string"===typeof d)return""===d?b._delete(a):b.set(a,d,null,!0),!0;if("number"===typeof d)return b.set(a,d,null,!0),!0;if(d instanceof Space&&!d.length)return b._delete(a),!0;if(b._getValueByProperty(a)instanceof Space)return b._getValueByProperty(a)._patch(d),!0;b.set(a,new Space(d),null,!0)});return this};Space.prototype.patch=function(a){this._patch(a);return this.trigger("patch",a).trigger("change")};
Space.prototype._patchOrder=function(a){a instanceof Space||(a=new Space(a));var b=this,c=this.clone();b._clear();a.each(function(a,e){b._setPair(a,c.get(a));e instanceof Space&&(e.length&&c._getValueByProperty(a)instanceof Space)&&b._getValueByProperty(a)._patchOrder(e)});return this};Space.prototype.patchOrder=function(a){this._patchOrder(a);return this.trigger("patchOrder",a).trigger("change")};
Space.prototype.pop=function(){if(!this.length)return null;var a=new Space,b=this._getPropertyByIndex(-1),c=this._getValueByProperty(b);a.set(b,c);this._delete(b);return a};Space.prototype.prepend=function(a,b){return this._setPair(a,b,0)};Space.prototype.prev=function(a){return this._getPropertyByIndex(this.indexOf(a)-1)};Space.prototype.push=function(a){for(var b=this.length;this.get(b.toString());)b++;this._setPair(b.toString(),a);return this};
Space.prototype._rename=function(a,b){var c=this.indexOf(a);if(-1===c)return this;this._setPair(b,this._getValueByProperty(a),c,!0);return this};Space.prototype.reload=function(a){this._properties=[];this._values=[];this._propertyCounts={};this._cache={};this._load(a);this.trigger("reload");return this};Space.prototype.rename=function(a,b){this._rename(a,b);a!==b&&this.trigger("rename",a,b);this.trigger("change");return this};
Space.prototype.renameAll=function(a,b,c){this.each(function(d,e,f){d===a&&this._setPair(b,e,f,!0);c&&e instanceof Space&&e.renameAll(a,b,c)});return this};Space.prototype.reverse=function(){this._properties.reverse();this._values.reverse();this._reindex();return this};Space.prototype.set=function(a,b,c,d){a=a.toString();if(Space.isXPath(a))this._setByXPath(a,b);else{var e=this.indexOf(a);-1<e?this._setPair(a,b,e,!0):this._setPair(a,b,c)}d||this.trigger("set",a,b,c).trigger("change");return this};
Space.prototype.setByIndexPath=function(a,b){if(!Space.isXPath(a)){var c=parseFloat(a);this.update(c,this._getPropertyByIndex(c),b);return this}c=Space.pathBranch(a);c=this.getByIndexPath(c);if(!c)return this;var d=parseFloat(Space.pathLeaf(a));c.update(d,c._getPropertyByIndex(d),b);return this};
Space.prototype._setByXPath=function(a,b){if(!a)return null;for(var c=a.toString().split(/ /g),d=this,e,f,g,h=c.length,j=0;j<h;j++){e=c[j];if((f=j===c.length-1)||!(d._getValueByProperty(e)instanceof Space))g=f?b:new Space,d.has(e)?(f=d.indexOf(e),d._setPair(e,g,f,!0)):d._setPair(e,g);d=d.get(e)}return this};
Space.prototype._setPair=function(a,b,c,d){a=a.toString();void 0===c?(this._properties.push(a),this._values.push(b)):d&&this._properties[c]?(d=this._properties[c],this._properties[c]=a,this._values[c]=b,this._propertyCounts[d]--,0===this._propertyCounts[d]&&delete this._cache[d]):c>=this.length?(this._properties.push(a),this._values.push(b)):(this._properties.splice(c,0,a),this._values.splice(c,0,b));this._updateIndexAndCache(a,b,c)};
Space.prototype._updateIndexAndCache=function(a,b,c){var d=this._propertyCounts[a];if(d)if(void 0===c)this._cache[a]=b;else{for(var e=this.length-1;e>c&&this._properties[e]!==a;e--);e===c&&(this._cache[a]=b)}else this._cache[a]=b;this._propertyCounts[a]=d?d+1:1};Space.prototype._reindex=function(){var a=this.length;this._propertyCounts={};this._cache={};for(var b=0;b<a;b++)this._updateIndexAndCache(this._properties[b],this._values[b],b)};
Space.prototype.shift=function(){if(!this.length)return null;var a=this._getPropertyByIndex(0),b=new Space;b.set(a,this.get(a));this._deleteByIndex(0);return b};Space.prototype.sort=function(a){for(var b=[],c=this.length,d=0;d<c;d++)b.push({property:this._properties[d],value:this._values[d]});b.sort(a);this._clear();for(d=0;d<c;d++)this._setPair(b[d].property,b[d].value);return this};
Space.prototype.split=function(a,b){var c=b?new Space:[],d=null;this.each(function(e,f){e===a&&(d&&(b?c.append(b,d):c.push(d)),d=new Space);if(!d)return!0;d.append(e,f)});d&&(b?c.append(b,d):c.push(d));return c};Space.prototype.tableOfContents=function(){return this.getProperties().join(" ")};Space.prototype.toCsv=function(){return this.toDelimited(",")};
Space.prototype.toDelimited=function(a,b){var c="",d=RegExp('(\\n|\\"|\\'+a+")"),e=function(a){return!a.match(d)?a:'"'+a.replace(/\"/g,'""')+'"'};b=b||[];var f={};b.length||this.each(function(a,c){if(!(c instanceof Space))return!0;c.each(function(a){if(f[a])return!0;b.push(a);f[a]=!0})});b.forEach(function(b){c+=a+e(b)});c=c.substr(1)+"\n";this.each(function(d,f){if(!(f instanceof Space))return!0;var j="";b.forEach(function(b){b=f.get(b)||"";j+=a+e(b.toString())});c+=j.substr(1)+"\n"});return c};
Space.prototype.toggle=function(a,b,c){this.get(a)===b?this.set(a,c):this.set(a,b);return this};Space.prototype.toJavascript=function(a){var b='new Space("'+this.toString().replace(/\n/g,"\\n").replace(/\"/g,'\\"')+'")';return a?b.replace(/\\n/g,"\\n\\\n"):b};Space.prototype.toJSON=function(a,b){return JSON.stringify(this.toObject(a),null,b?" ":null)};
Space.prototype._toObject=function(){var a=this.getProperties(),b=0<a.length,c=0;a.forEach(function(a){a!==c.toString()&&(b=!1);c++});var d=b?[]:{};this.each(function(a,c){var g;g=c instanceof Space?c._toObject():"false"===c?!1:"true"===c?!0:"null"===c?null:c.match(/^[\-\.]?[0-9]+[0-9\.]*$/)?parseFloat(c):c;b?d.push(g):d[a]=g});return d};Space.prototype.toObject=function(a){if(a)return this._toObject();var b={};this.each(function(a,d){b[a]=d instanceof Space?d.toObject():d});return b};
Space.prototype.toQueryString=function(){var a="",b="";this.each(function(c,d){a+=b+encodeURIComponent(c)+"="+encodeURIComponent(d);b="&"});return a};Space.prototype.toSsv=function(){return this.toDelimited(" ")};
Space.prototype.toString=function(a){a=a||0;var b="";this.each(function(c,d){if(void 0===d||null===d)return b+=c+" \n",!0;b+=Space.strRepeat(" ",a)+c;b=d instanceof Space?b+("\n"+d.toString(a+1)):"object"===typeof d?b+("\n"+(new Space(d)).toString(a+1)):""===d.toString()?b+" \n":d.toString().match(/\n/)?b+(" "+d.toString().replace(/\n/g,"\n"+Space.strRepeat(" ",a+1))+"\n"):b+(" "+d.toString()+"\n")});return b};Space.prototype.toTsv=function(){return this.toDelimited("\t")};Space.prototype.toURL=function(){return encodeURIComponent(this.toString())};
Space.prototype.toXML=function(a){return this._toXML(a?0:-1)};Space.prototype._toXML=function(a){var b="",c=-1===a?"":Space.strRepeat(" ",a);this.each(function(d,e){b+=c+"<"+d+">";e instanceof Space?0<e.length&&(b+=(-1===a?"":"\n")+e._toXML(-1<a?a+2:-1)+c):b+=e;b+="</"+d+">"+(-1===a?"":"\n")});return b};Space.prototype.toXMLWithAttributes=function(a){return this.firstValue()._toXMLWithAttributes(this.firstProperty(),a?0:-1)};
Space.prototype._toXMLWithAttributes=function(a,b){var c="",d=-1===b?"":Space.strRepeat(" ",b),e="",f="",g=this.get("children");this.each(function(a,b){if("children"===a)return!0;e=b&&b.replace?e+(" "+a+'="'+b.replace('"','\\"')+'"'):e+(" "+a)});g&&g.each(function(a,c){f=c instanceof Space?f+((-1===b?"":"\n")+c._toXMLWithAttributes(a,-1<b?b+2:-1)+d):f+c;if("children"===a)return!0});return c+(d+"<"+a+e+">"+f+"</"+a+">"+(-1===b||!f?"":"\n"))};
Space.prototype.trigger=function(a){if(!this._events||!this._events[a])return this;var b=Array.prototype.slice.call(arguments),c;for(c in this._events[a])this._events[a][c].apply(this,b.slice(1));return this};Space.prototype.trim=function(a){var b=[];this.each(function(c,d,e){d instanceof Space?(a&&d.trim(a),0===d.length&&b.push(e)):d||b.push(e)});Space.removeItems(this._properties,b);Space.removeItems(this._values,b);this._reindex();return this};
Space.prototype.update=function(a,b,c){this._setPair(b,c,a,!0);return this};Space.prototype.wrap=function(a){var b=new Space;b.set(a,this);return this.reload(b.toString())};"undefined"!==typeof exports&&(module.exports=Space);
